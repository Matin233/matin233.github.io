(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{410:function(t,e,a){"use strict";a.r(e);var n=a(44),s=Object(n.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"app-实例"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#app-实例"}},[t._v("#")]),t._v(" App 实例")]),t._v(" "),a("h2",{attrs:{id:"概要"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概要"}},[t._v("#")]),t._v(" 概要")]),t._v(" "),a("p",[t._v("每个小程序都需要在 "),a("code",[t._v("app.js")]),t._v(" 中调用 "),a("code",[t._v("App")]),t._v(" 方法注册小程序实例，绑定生命周期回调函数、错误监听和页面不存在监听函数等。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// app.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("App")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onLaunch")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("options")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Do something initial when launch.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onShow")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("options")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Do something when show.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onHide")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Do something when hide.")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("onError")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("msg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("msg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  globalData"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'I am global data'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("整个小程序只有一个 App 实例，是全部页面共享的。开发者可以通过 "),a("code",[t._v("getApp")]),t._v(" 方法获取到全局唯一的 App 实例，获取App上的数据或调用开发者注册在 "),a("code",[t._v("App")]),t._v(" 上的函数。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// xxx.js")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" appInstance "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getApp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("appInstance"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("globalData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// I am global data")]),t._v("\n")])])]),a("h2",{attrs:{id:"生命周期方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生命周期方法"}},[t._v("#")]),t._v(" 生命周期方法")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("属性")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("类型")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("默认值")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("必填")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("说明")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("最低版本")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("onLaunch")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("function")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("否")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("小程序初始化完成时触发，全局只触发一次。参数也可以使用 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/base/app/life-cycle/wx.getLaunchOptionsSync.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("wx.getLaunchOptionsSync"),a("OutboundLink")],1),t._v(" 获取。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("onShow")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("function")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("否")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("小程序启动，或从后台进入前台显示时触发。也可以使用 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onAppShow.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("wx.onAppShow"),a("OutboundLink")],1),t._v(" 绑定监听。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("onHide")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("function")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("否")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("小程序从前台进入后台时触发。也可以使用 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onAppHide.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("wx.onAppHide"),a("OutboundLink")],1),t._v(" 绑定监听。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("onError")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("function")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("否")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("小程序发生脚本错误或 API 调用报错时触发。也可以使用 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onError.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("wx.onError"),a("OutboundLink")],1),t._v(" 绑定监听。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("onPageNotFound")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("function")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("否")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("小程序要打开的页面不存在时触发。也可以使用 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onPageNotFound.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("wx.onPageNotFound"),a("OutboundLink")],1),t._v(" 绑定监听。注意事项请参考 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onPageNotFound.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("wx.onPageNotFound"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("1.9.90"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("onUnhandledRejection")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("function")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("否")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("小程序有未处理的 Promise 拒绝时触发。也可以使用 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onUnhandledRejection.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("wx.onUnhandledRejection"),a("OutboundLink")],1),t._v(" 绑定监听。注意事项请参考 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onUnhandledRejection.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("wx.onUnhandledRejection"),a("OutboundLink")],1),t._v("。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.10.0"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("onThemeChange")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("function")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("否")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("系统切换主题时触发。也可以使用 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/base/app/app-event/wx.onThemeChange.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("wx.onThemeChange"),a("OutboundLink")],1),t._v(" 绑定监听。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("2.11.0"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("其他")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("any")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}}),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("否")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("开发者可以添加任意的函数或数据变量到 "),a("code",[t._v("Object")]),t._v(" 参数中，用 "),a("code",[t._v("this")]),t._v(" 可以访问")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}})])])]),t._v(" "),a("h2",{attrs:{id:"小程序运行机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序运行机制"}},[t._v("#")]),t._v(" 小程序运行机制")]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("提示")]),t._v(" "),a("p",[t._v("这一节的内容对于初次阅读者不是必须的，你可以选择先跳过它")])]),t._v(" "),a("h3",{attrs:{id:"生命周期过程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生命周期过程"}},[t._v("#")]),t._v(" 生命周期过程")]),t._v(" "),a("p",[t._v("小程序从启动到最终被销毁，会经历很多不同的状态，小程序在不同状态下会有不同的表现。")]),t._v(" "),a("p",[a("img",{attrs:{src:"https://res.wx.qq.com/wxdoc/dist/assets/img/life-cycle.5558d9eb.svg",alt:"小程序生命周期"}})]),t._v(" "),a("h4",{attrs:{id:"小程序启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序启动"}},[t._v("#")]),t._v(" 小程序启动")]),t._v(" "),a("p",[t._v("从用户认知的角度看，广义的小程序启动可以分为两种情况，一种是"),a("strong",[t._v("冷启动")]),t._v("，一种是"),a("strong",[t._v("热启动")]),t._v("。")]),t._v(" "),a("ul",[a("li",[t._v("冷启动：如果用户首次打开，或小程序销毁后被用户再次打开，此时小程序需要重新加载启动，即冷启动。")]),t._v(" "),a("li",[t._v("热启动：如果用户已经打开过某小程序，然后在一定时间内再次打开该小程序，此时小程序并未被销毁，只是从后台状态进入前台状态，这个过程就是热启动。")])]),t._v(" "),a("p",[t._v("从小程序生命周期的角度来看，我们一般讲的「"),a("strong",[t._v("启动")]),t._v("」专指冷启动，热启动一般被称为后台切前台。")]),t._v(" "),a("h4",{attrs:{id:"前台与后台"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前台与后台"}},[t._v("#")]),t._v(" 前台与后台")]),t._v(" "),a("p",[t._v("小程序启动后，界面被展示给用户，此时小程序处于「"),a("strong",[t._v("前台")]),t._v("」状态。")]),t._v(" "),a("p",[t._v("当用户「关闭」小程序时，小程序并没有真正被关闭，而是进入了「"),a("strong",[t._v("后台")]),t._v("」状态，此时小程序还可以短暂运行一小段时间，但部分 API 的使用会收到限制。切后台的方式包括但不限于以下几种：")]),t._v(" "),a("ul",[a("li",[t._v("点击右上角胶囊按钮离开小程序")]),t._v(" "),a("li",[t._v("iOS 从屏幕左侧右滑离开小程序")]),t._v(" "),a("li",[t._v("安卓点击返回键离开小程序")]),t._v(" "),a("li",[t._v("小程序前台运行时直接把微信切后台（手势或 Home 键）")]),t._v(" "),a("li",[t._v("小程序前台运行时直接锁屏")])]),t._v(" "),a("p",[t._v("当用户再次进入微信并打开小程序，小程序又会重新进入「"),a("strong",[t._v("前台")]),t._v("」状态。")]),t._v(" "),a("h4",{attrs:{id:"挂起"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#挂起"}},[t._v("#")]),t._v(" 挂起")]),t._v(" "),a("p",[t._v("小程序进入「后台」状态一段时间后（目前是 5 秒），微信会停止小程序 JS 线程的执行，小程序进入「"),a("strong",[t._v("挂起")]),t._v("」状态。此时小程序的内存状态会被保留，但开发者代码执行会停止，事件和接口回调会在小程序再次进入「前台」时触发。")]),t._v(" "),a("p",[t._v("当开发者使用了"),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/media/background-audio/wx.getBackgroundAudioManager.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("后台音乐播放"),a("OutboundLink")],1),t._v("、"),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/location/wx.startLocationUpdateBackground.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("后台地理位置"),a("OutboundLink")],1),t._v("等能力时，小程序可以在「后台」持续运行，不会进入到「挂起」状态")]),t._v(" "),a("h4",{attrs:{id:"小程序销毁"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序销毁"}},[t._v("#")]),t._v(" 小程序销毁")]),t._v(" "),a("p",[t._v("如果用户很久没有使用小程序，或者系统资源紧张，小程序会被「"),a("strong",[t._v("销毁")]),t._v("」，即完全终止运行。具体而言包括以下几种情形：")]),t._v(" "),a("ul",[a("li",[t._v("当小程序进入后台并被「挂起」后，如果很长时间（目前是 30 分钟）都未再次进入前台，小程序会被销毁。")]),t._v(" "),a("li",[t._v("当小程序占用系统资源过高，可能会被系统销毁或被微信客户端主动回收。\n"),a("ul",[a("li",[t._v("在 iOS 上，当微信客户端在一定时间间隔内连续收到系统内存告警时，会根据一定的策略，主动销毁小程序，并提示用户 「运行内存不足，请重新打开该小程序」。具体策略会持续进行调整优化。")]),t._v(" "),a("li",[t._v("建议小程序在必要时使用 "),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/api/device/memory/wx.onMemoryWarning.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("wx.onMemoryWarning"),a("OutboundLink")],1),t._v(" 监听内存告警事件，进行必要的内存清理。")])])])]),t._v(" "),a("blockquote",[a("p",[t._v("基础库 1.1.0 及以上，1.4.0 以下版本: 当用户从扫一扫、转发等入口（"),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/scene.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("场景值"),a("OutboundLink")],1),t._v("为1007, 1008, 1011, 1025）进入小程序，且没有置顶小程序的情况下退出，小程序会被销毁。")])]),t._v(" "),a("h3",{attrs:{id:"小程序冷启动的页面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序冷启动的页面"}},[t._v("#")]),t._v(" 小程序冷启动的页面")]),t._v(" "),a("p",[t._v("小程序冷启动时，打开的页面有以下情况")]),t._v(" "),a("ul",[a("li",[t._v("（A 类场景）若启动的场景中不带 path\n"),a("ul",[a("li",[t._v("基础库 2.8.0 以下版本，进入首页")]),t._v(" "),a("li",[t._v("基础库 2.8.0 及以上版本遵循「重新启动策略」，可能是首页或上次退出的页面")])])]),t._v(" "),a("li",[t._v("（B 类场景）若启动的场景中带有 path，则启动进入对应 path 的页面")])]),t._v(" "),a("h4",{attrs:{id:"重新启动策略"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重新启动策略"}},[t._v("#")]),t._v(" 重新启动策略")]),t._v(" "),a("blockquote",[a("p",[t._v("基础库 2.8.0 开始支持，低版本需做"),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("兼容处理"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("p",[t._v("小程序冷启动时，如果启动时不带 path（A 类场景），默认情况下将会进入小程序的首页。 在页面对应的 json 文件中（也可以全局配置在 app.json 的 window 段中），指定 "),a("code",[t._v("restartStrategy")]),t._v(" 配置项可以改变这个默认的行为，使得从某个页面退出后，下次 A 类场景的冷启动可以回到这个页面。")]),t._v(" "),a("p",[a("strong",[t._v("代码示例：")])]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"restartStrategy"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"homePage"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("code",[t._v("restartStrategy")]),t._v(" 可选值：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("可选值")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("homePage")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("（默认值）如果从这个页面退出小程序，下次将从首页冷启动")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("homePageAndLatestPage")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("如果从这个页面退出小程序，下次冷启动后立刻加载这个页面，页面的参数保持不变（不可用于 tab 页）")])])])]),t._v(" "),a("p",[t._v("注意：即使不配置为 "),a("code",[t._v("homePage")]),t._v(" ，小程序如果退出过久（当前默认一天时间，可以使用"),a("strong",[t._v("退出状态")]),t._v("来调整），下次冷启动时也将不再遵循 "),a("code",[t._v("restartStrategy")]),t._v(" 的配置，而是直接从首页冷启动。")]),t._v(" "),a("p",[t._v("无论如何，页面中的状态并不会被保留，如输入框中的文本内容、 checkbox 的勾选状态等都不会还原。如果需要还原或部分还原，需要利用"),a("strong",[t._v("退出状态")]),t._v("。")]),t._v(" "),a("h3",{attrs:{id:"小程序热启动的页面"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#小程序热启动的页面"}},[t._v("#")]),t._v(" 小程序热启动的页面")]),t._v(" "),a("p",[t._v("小程序冷启动时，打开的页面有以下情况")]),t._v(" "),a("ul",[a("li",[t._v("（A 类场景）若启动的场景中不带 path，则保留上次的浏览的状态")]),t._v(" "),a("li",[t._v("（B 类场景）若启动的场景中带有 path，则 relaunch 到对应 path 的页面")])]),t._v(" "),a("p",[t._v("A 类场景常见的有下列"),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/app-service/scene.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("场景值"),a("OutboundLink")],1),t._v("：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("场景值ID")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("说明")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1001")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("发现栏小程序主入口，「最近使用」列表（基础库2.2.4版本起包含「我的小程序」列表）")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1003")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("星标小程序列表")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1023")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("系统桌面小图标打开小程序")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1038")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("从其他小程序返回小程序")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1056")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("聊天顶部音乐播放器右上角菜单，打开小程序")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1080")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("客服会话菜单小程序入口，打开小程序")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1083")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("公众号会话菜单小程序入口 ，打开小程序（只有腾讯客服小程序有）")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1089")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("聊天主界面下拉，打开小程序/微信聊天主界面下拉，「最近使用」栏（基础库2.2.4版本起包含「我的小程序」栏）")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1090")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("长按小程序右上角菜单，打开小程序")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1103")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("发现-小程序主入口我的小程序，打开小程序")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1104")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("聊天主界面下拉，从我的小程序，打开小程序")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1113")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("安卓手机负一屏，打开小程序")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1114")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("安卓手机侧边栏，打开小程序")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("1117")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("后台运行小程序的管理页中，打开小程序")])])])]),t._v(" "),a("h3",{attrs:{id:"退出状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#退出状态"}},[t._v("#")]),t._v(" 退出状态")]),t._v(" "),a("blockquote",[a("p",[t._v("基础库 2.7.4 开始支持，低版本需做"),a("a",{attrs:{href:"https://developers.weixin.qq.com/miniprogram/dev/framework/compatibility.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("兼容处理"),a("OutboundLink")],1),t._v("。")])]),t._v(" "),a("p",[t._v("每当小程序可能被销毁之前，页面回调函数 "),a("code",[t._v("onSaveExitState")]),t._v(" 会被调用。如果想保留页面中的状态，可以在这个回调函数中“保存”一些数据，下次启动时可以通过 "),a("code",[t._v("exitState")]),t._v(" 获得这些已保存数据。")]),t._v(" "),a("p",[a("strong",[t._v("代码示例：")])]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"restartStrategy"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"homePageAndLatestPage"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nPage("),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  onLoad"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" function() "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    var prevExitState = this.exitState "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 尝试获得上一次退出前 onSaveExitState 保存的数据")]),t._v("\n    if (prevExitState !== undefined) "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果是根据 restartStrategy 配置进行的冷启动，就可以获取到")]),t._v("\n      prevExitState.myDataField === 'myData' \n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  onSaveExitState"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" function() "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    var exitState = "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" myDataField"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" 'myData' "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 需要保存的数据")]),t._v("\n    return "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      data"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" exitState"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      expireTimeStamp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" Date.now() + "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("24")]),t._v(" * "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" * "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60")]),t._v(" * "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 超时时刻")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(")\n")])])]),a("p",[a("code",[t._v("onSaveExitState")]),t._v(" 返回值可以包含两项：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("字段名")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("类型")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("含义")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("data")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Any")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("需要保存的数据（只能是 JSON 兼容的数据）")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("expireTimeStamp")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("Number")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("超时时刻，在这个时刻后，保存的数据保证一定被丢弃，默认为 (当前时刻 + 1 天)")])])])]),t._v(" "),a("p",[t._v("一个更完整的示例："),a("a",{attrs:{href:"https://developers.weixin.qq.com/s/ELP5uTmN7E8l",target:"_blank",rel:"noopener noreferrer"}},[t._v("在开发者工具中预览效果"),a("OutboundLink")],1)]),t._v(" "),a("h3",{attrs:{id:"注意事项"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意事项"}},[t._v("#")]),t._v(" 注意事项")]),t._v(" "),a("ul",[a("li",[t._v("如果超过 "),a("code",[t._v("expireTimeStamp")]),t._v(" ，保存的数据将被丢弃，且冷启动时不遵循 "),a("code",[t._v("restartStrategy")]),t._v(" 的配置，而是直接从首页冷启动。")]),t._v(" "),a("li",[a("code",[t._v("expireTimeStamp")]),t._v(" 有可能被自动提前，如微信客户端需要清理数据的时候。")]),t._v(" "),a("li",[t._v("在小程序存活期间， "),a("code",[t._v("onSaveExitState")]),t._v(" 可能会被多次调用，此时以最后一次的调用结果作为最终结果。")]),t._v(" "),a("li",[t._v("在某些特殊情况下（如微信客户端直接被系统杀死），这个方法将不会被调用，下次冷启动也不遵循 "),a("code",[t._v("restartStrategy")]),t._v(" 的配置，而是直接从首页冷启动。")])])])}),[],!1,null,null,null);e.default=s.exports}}]);